# this config needs haproxy-1.1.28 or haproxy-1.2.1

global
        log 127.0.0.1   local0
        log 127.0.0.1   local1 notice
        #log loghost    local0 info
        maxconn 4096
        #chroot /usr/share/haproxy
        user haproxy
        group haproxy
        daemon
        #debug
        #quiet

defaults
        log     global
        mode    http
        option  httplog
        option  dontlognull
        retries 3
        option redispatch
        maxconn 2000
        contimeout      5000
        clitimeout      50000
        srvtimeout      50000

listen mysql-cluster 0.0.0.0:3306
        mode tcp
        balance roundrobin
        option mysql-check user root
{% for host,vars in hostvars.items() %}
	server {{host}} {{vars['ansible_eth0']['ipv4']['address']}}:3306
{%- endfor %}

listen haproxy_status 0.0.0.0:8080
    mode http
    stats enable
    stats uri /haproxy?stats
    stats realm Private
    stats auth haproxy:secrete
